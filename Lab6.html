<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Memory</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <link rel="stylesheet" type="text/css" href="estilos.css">
  </head>  
  <body class="bodyBackground">
    <div id="root"></div>
    
    <script type="text/babel">
      var elegidas = []
      var correctas = []
      var validacion
      var contador = 0

      class Carta extends React.Component{
        constructor (props){
          super(props)
          this.state = {
            imagenFondo: "atras"
          }
        }
        
        handleClick() {
          if(elegidas.length < 2 && this.props.idPosicion != validacion){
            validacion = this.props.idPosicion
            this.setState({
              imagenFondo: this.props.imagen
            })

            elegidas.push(this.props.id)
            setTimeout(() => {
            //console.log("Espero")
            if(elegidas.length < 2){

            }
            else{
              if(elegidas[0] == elegidas[1] && elegidas[0] != null && elegidas[1] != null){
                correctas.push(this.props.id)
                elegidas.pop()
                elegidas.pop()
                if (correctas.length == 8){
                  alert("Felicidades - Has Ganado")
                }
              }
              elegidas = []
              //console.log(elegidas)
              //console.log(correctas)
              if(!correctas.includes(this.props.id)){
                this.setState({
                imagenFondo: "atras"
                })
              }
            }
            if(!correctas.includes(this.props.id)){
              this.setState({
                imagenFondo: "atras"
                
              })
              validacion = null
              elegidas.pop()
            }
            }, 1000)  
          }
        }

        render(){
          const estilo  = {
            display: "flex",
            justifyContent: "center",
            alignItems: "center",
            backgroundColor: "black"

          }

          //Se verifica que todos tengan ID 
          //console.log(this.props.id)

          return (
              <div style={estilo} onClick={this.handleClick.bind(this)}>
                <div className={this.state.imagenFondo}></div>
              </div>
          )                   
        }
      }
      class Game extends React.Component {
        //Aqui se hace el grid del juego
        render(){
          const grid = {
            display: "grid",
            gridTemplateColumns: "100px 100px 100px 100px",
            gridTemplateRows: "150px 150px 150px 150px",  
            gridColumnGap: "10px",
            gridRowGap: "10px",


          }
          const flex = {
            display: "flex",
            justifyContent: "center"
          }

          //Creamos un arreglo fijo a mezclar
          const arregloFijo = [0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7]
          const arregloImagenes = ["imagen1","imagen2","imagen3","imagen4","imagen5","imagen6","imagen7","imagen8"]
          //Creamos un arreglo para meter la mezcla del anterior
          const arregloAleatorio = []

          //Se hace un ciclo while para ir pasando los numeros del arreglo fijo al mezclado
          while(arregloFijo.length>0){
            var arreglo = arregloFijo.splice(Math.floor(Math.random() * arregloFijo.length), 1)
            arreglo = arreglo[0]
            arregloAleatorio.push(arreglo)
          }

          //Se verifica que todos los numeros hayan sido sacados del arreglo fijo, y que se pasen revueltos los numeros al mezclado
          console.log(arregloAleatorio)
          console.log(arregloFijo)

          //Se muestra en pantalla el HTML de las cartas
          return (
            <div>
          	<div style={flex}>
	            <div style={grid}>
	              <Carta id = {arregloAleatorio[0]}  imagen = {arregloImagenes[arregloAleatorio[0]]} idPosicion = '0' />
	              <Carta id = {arregloAleatorio[1]}  imagen = {arregloImagenes[arregloAleatorio[1]]} idPosicion = '1' />
	              <Carta id = {arregloAleatorio[2]}  imagen = {arregloImagenes[arregloAleatorio[2]]} idPosicion = '2' />
	              <Carta id = {arregloAleatorio[3]}  imagen = {arregloImagenes[arregloAleatorio[3]]} idPosicion = '3' />
	              <Carta id = {arregloAleatorio[4]}  imagen = {arregloImagenes[arregloAleatorio[4]]} idPosicion = '4' />
	              <Carta id = {arregloAleatorio[5]}  imagen = {arregloImagenes[arregloAleatorio[5]]} idPosicion = '5' />
	              <Carta id = {arregloAleatorio[6]}  imagen = {arregloImagenes[arregloAleatorio[6]]} idPosicion = '6' />
	              <Carta id = {arregloAleatorio[7]}  imagen = {arregloImagenes[arregloAleatorio[7]]} idPosicion = '7' />
	              <Carta id = {arregloAleatorio[8]}  imagen = {arregloImagenes[arregloAleatorio[8]]} idPosicion = '8' />
	              <Carta id = {arregloAleatorio[9]}  imagen = {arregloImagenes[arregloAleatorio[9]]} idPosicion = '9' />
	              <Carta id = {arregloAleatorio[10]}  imagen = {arregloImagenes[arregloAleatorio[10]]} idPosicion = '10' />
	              <Carta id = {arregloAleatorio[11]}  imagen = {arregloImagenes[arregloAleatorio[11]]} idPosicion = '11' />
	              <Carta id = {arregloAleatorio[12]}  imagen = {arregloImagenes[arregloAleatorio[12]]} idPosicion = '12' />
	              <Carta id = {arregloAleatorio[13]}  imagen = {arregloImagenes[arregloAleatorio[13]]} idPosicion = '13' />
	              <Carta id = {arregloAleatorio[14]}  imagen = {arregloImagenes[arregloAleatorio[14]]} idPosicion = '14' />
	              <Carta id = {arregloAleatorio[15]}  imagen = {arregloImagenes[arregloAleatorio[15]]} idPosicion = '15' />
	            </div>
       	  	</div>
             <div style={flex}>

             </div>
            </div>
          )
        }   
      }

    ReactDOM.render(<Game />, document.getElementById('root'))
    </script>
  </body>
</html>
